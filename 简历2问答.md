##### 1. é—®é¢˜å•æŸ¥è¯¢æ•ˆç‡ 80%

- ORM æŸ¥è¯¢ä¼˜åŒ–ï¼Œä½¿ç”¨ only é™ä½åºåˆ—åŒ–æ•°æ®é‡ï¼Œä½¿ç”¨ seleted_related, prefetch_related å‡å°‘å…³è”è¡¨çš„ N+1 æŸ¥è¯¢

- ä½¿ç”¨ annotate å’Œ values åœ¨æ•°æ®åº“å±‚é¢ç›´æ¥å®Œæˆèšåˆè®¡ç®—
- MySQL ç´¢å¼•ä¼˜åŒ–ï¼Œä¸ºé«˜é¢‘è¿‡æ»¤å­—æ®µï¼ˆå¦‚ status, created_atï¼‰æ·»åŠ è”åˆç´¢å¼•ã€‚
  ä½¿ç”¨ EXPLAIN åˆ†æ==æ…¢æŸ¥è¯¢==ï¼ŒéªŒè¯ç´¢å¼•å‘½ä¸­æƒ…å†µã€‚



è°ƒè¯•å·¥å…·ï¼š

- Django Debug Toolbarï¼šæŸ¥çœ‹æ¯ä¸ªè¯·æ±‚çš„ SQL æŸ¥è¯¢æ¬¡æ•°ä¸è€—æ—¶
- django-silkï¼šç”Ÿäº§ç¯å¢ƒä¸‹çš„æ€§èƒ½åˆ†æå·¥å…·



##### 2. ç”¨æˆ·å·¥ä½œäº¤æ¥æ•ˆç‡æå‡ 50%

- åº”ç”¨å·é€šçŸ¥ï¼Œå¦‚ä½•å®ç°å‘¢ï¼Ÿé€šè¿‡è§¦å‘å™¨ã€‚



##### 3. ä»»åŠ¡æ±‡æ€»æ•ˆç‡æå‡ 97%

- å®šæ—¶å¼‚æ­¥ä»»åŠ¡ï¼ˆCelery Beatï¼‰ æå‰ç”Ÿæˆæ¯æ—¥çš„æ±‡æ€»æŠ¥è¡¨å¹¶ç¼“å­˜ã€‚

  æ¯æ¬¡æ¶‰åŠæ±‡æ€»æŠ¥è¡¨çš„æ•°æ®åº“å­—æ®µæ›´æ–°æ—¶ï¼Œä¼šè®°å½•æ›´æ–°æ—¶é—´ã€‚æ¯æ¬¡ç¼“å­˜çš„æŠ¥è¡¨ä¹Ÿä¼šè®°å½•ä¸Šä¸€æ¬¡çš„æ›´æ–°æ—¶é—´ï¼Œåœ¨ç”ŸæˆæŠ¥è¡¨æ—¶ï¼Œä¼šæ¯”å¯¹æ—¶é—´æ¥å†³å®šæ˜¯å¦éœ€è¦é‡æ–°ç”Ÿæˆã€‚



##### 4. é—®é¢˜å•è‡ªåŠ¨åŒæ­¥æ•ˆç‡æå‡ 75%

- è®°å½•æœ€ååŒæ­¥æ—¶é—´æˆ³ï¼Œä»…åŒæ­¥å¢é‡æ•°æ®

- æ•°æ®åº“ä¿¡å·ç›‘å¬ï¼ŒDjango Signals ç›‘å¬æ¨¡å‹å˜æ›´äº‹ä»¶è§¦å‘åŒæ­¥

  ```python
  from django.db.models.signals import post_save  
  from django.dispatch import receiver  
  
  @receiver(post_save, sender=Ticket)  
  def on_ticket_update(sender, instance, **kwargs):
      if kwargs.get('created') or instance.status_changed:  
          external_system.sync(instance)  
  
  ```

- æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦ï¼ŒRabbitMQ/Kafka æ¥æ”¶åŒæ­¥äº‹ä»¶ï¼Œå¼‚æ­¥å¤„ç†æ•°æ®åŒæ­¥

  ```python
  # ç”Ÿäº§è€…ï¼ˆè§¦å‘åŒæ­¥äº‹ä»¶ï¼‰
  from kombu import Connection  
  with Connection('amqp://guest:guest@localhost//') as conn:
      producer = conn.Producer()
      producer.publish({'ticket_id': 123}, exchange='sync', routing_key='ticket')  
  
  # æ¶ˆè´¹è€…ï¼ˆCelery Worker å¤„ç†ï¼‰
  @shared_task  
  def consume_sync_event(event):
      ticket = Ticket.objects.get(id=event['ticket_id'])
      external_system.sync(ticket)  
  
  ```



##### 5. å¼€å‘çƒ­æ›´æ–°æœºåˆ¶ï¼Œæ”¯æŒä¸é‡å¯æ¸¸æˆçš„é…ç½®çƒ­åŠ è½½

ç›®æ ‡ï¼šä¿®æ”¹é…ç½®æˆ–é€»è¾‘æ—¶æ— éœ€é‡å¯æ¸¸æˆã€‚

å¯èƒ½å®ç°ï¼š

- åŠ¨æ€èµ„æºåŠ è½½ï¼šåˆ©ç”¨ Lua çš„ require å‡½æ•°é‡è½½æœºåˆ¶ï¼Œç»“åˆ package.loaded æ¸…ç†å·²åŠ è½½æ¨¡å—ã€‚

- æ–‡ä»¶ç›‘å¬ï¼šé€šè¿‡ C æ‰©å±•ç›‘å¬é…ç½®æ–‡ä»¶å˜åŒ–ï¼ˆå¦‚ inotify æˆ–è‡ªå®šä¹‰è½®è¯¢ï¼‰ï¼Œè§¦å‘ Lua å›è°ƒã€‚

  å…³äºæ–‡ä»¶ç›‘å¬ï¼Œä¸ªäººç†è§£ï¼šPython å®ç°ä¸€ä¸ªé¡¹ç›® lua ä»£ç æ–‡ä»¶å˜åŒ–æ£€ç´¢ç¨‹åºï¼Œä¸€é”®æ‰§è¡Œçƒ­æ›´æ–°æ“ä½œã€‚å¤§å¤§æé«˜äº†å¼€å‘æ•ˆç‡ã€‚

ã€ æå‡å¼€å‘æ•ˆç‡ï¼Œæ”¯æŒå¿«é€Ÿè¿­ä»£ï¼Œé¿å…é¢‘ç¹é‡å¯æ¸¸æˆæµ‹è¯•ã€‚ã€‘



##### 6. é‡‡ç”¨æ¨¡å—åŒ–å¼€å‘æ¨¡å¼ï¼Œåˆ›å»º Mod API ä»“åº“

æ„å»ºå…±äº«å·¥å…·åº“ï¼Œå°è£…å¸¸ç”¨å‡½æ•°ï¼Œå¹¶å‘å¸ƒåˆ°åˆ›æ„å·¥åŠä½œä¸ºä¾èµ–åŒ…ä½¿ç”¨ã€‚

ã€æœ‰æ„è¯†åœ°å¼€å‘ç¬¬ä¸‰æ–¹åº“ã€‘

ã€é™ä½ä»£ç è€¦åˆï¼Œä¾¿äºå›¢é˜Ÿåä½œï¼Œä»£ç å¤ç”¨ç‡æå‡ 40%ã€‚ã€‘



##### 7. æ”¶é›† 600+ ç”¨æˆ·åé¦ˆï¼Œè¿­ä»£äº† 20 ä¸ªç‰ˆæœ¬

ã€é€šè¿‡ç¤¾åŒºåé¦ˆä¼˜åŒ–å¹³è¡¡æ€§ï¼ˆå¦‚è°ƒæ•´ç‰©å“æ‰è½æ¦‚ç‡ï¼‰ï¼Œç”¨æˆ·ç•™å­˜ç‡æå‡ 25%ã€‚ã€‘





##### 8. å¼•å…¥ DeepSeek API å®ç°åŠ¨æ€å¯¹è¯ç³»ç»Ÿ

åŠŸèƒ½ç›®æ ‡ï¼š

NPC æ ¹æ®ç©å®¶è¡Œä¸º/ç¯å¢ƒçŠ¶æ€ç”ŸæˆåŠ¨æ€å¯¹è¯ï¼ˆå¦‚å¤©æ°”å˜åŒ–æ—¶æç¤ºâ€œè¦ä¸‹é›¨äº†ï¼Œå¿«æ‰¾é¿é›¨å¤„ï¼â€ï¼‰ã€‚
ç©å®¶ä¸ç”Ÿç‰©äº¤äº’æ—¶è§¦å‘ä¸Šä¸‹æ–‡ç›¸å…³çš„å¯¹è¯æ ‘ï¼ˆå¦‚å–‚é£Ÿå® ç‰©åè§¦å‘æ„Ÿè°¢è¯­éŸ³ï¼‰ã€‚



æ¶æ„åˆ†å±‚ï¼š

ç©å®¶è¾“å…¥/äº‹ä»¶ â†’ Lua é€»è¾‘å±‚ï¼ˆè¯·æ±‚ç»„è£…ï¼‰ â†’ C ç½‘ç»œå±‚ï¼ˆHTTP è°ƒç”¨ DeepSeek APIï¼‰ â†’ å“åº”è§£æ â†’ å¯¹è¯å±•ç¤º



æŠ€æœ¯å®ç°ç»†èŠ‚ï¼š

Lua ç›´æ¥è°ƒç”¨ HTTP è¯·æ±‚å­˜åœ¨å±€é™æ€§ï¼ˆå¦‚å¼‚æ­¥æ”¯æŒå¼±ï¼‰ï¼Œéœ€é€šè¿‡ C æ‰©å±•å®ç°é«˜æ€§èƒ½ç½‘ç»œé€šä¿¡ã€‚

C æ¨¡å—ç¼–å†™ï¼šåŸºäº libcurl å°è£…å¼‚æ­¥ HTTP å®¢æˆ·ç«¯ï¼Œæ”¯æŒéé˜»å¡è¯·æ±‚ã€‚

Lua ç»‘å®šï¼šæš´éœ² deepseek_request(prompt, callback) å‡½æ•°ç»™ Lua å±‚ã€‚

```markdown
### ğŸ¤– Assistant

---

### **æ¥å…¥ DeepSeek API å®ç°æ¨¡æ‹Ÿå¯¹è¯æœºåˆ¶**  
åœ¨é¥¥è’æ¨¡ç»„ä¸­å¼•å…¥ **DeepSeek API** å®ç°åŠ¨æ€å¯¹è¯ç³»ç»Ÿï¼Œå¯ä¸º NPCã€ç”Ÿç‰©æˆ–ç‰©å“æ·»åŠ æ™ºèƒ½äº¤äº’èƒ½åŠ›ï¼Œæå‡ç©å®¶æ²‰æµ¸æ„Ÿã€‚ä»¥ä¸‹æ˜¯æŠ€æœ¯å®ç°æ–¹æ¡ˆä¸å…³é”®æ­¥éª¤ï¼š

---

#### **1. æ ¸å¿ƒè®¾è®¡æ€è·¯**  
- **åŠŸèƒ½ç›®æ ‡**ï¼š  
  - NPC æ ¹æ®ç©å®¶è¡Œä¸º/ç¯å¢ƒçŠ¶æ€ç”ŸæˆåŠ¨æ€å¯¹è¯ï¼ˆå¦‚å¤©æ°”å˜åŒ–æ—¶æç¤ºâ€œè¦ä¸‹é›¨äº†ï¼Œå¿«æ‰¾é¿é›¨å¤„ï¼â€ï¼‰ã€‚  
  - ç©å®¶ä¸ç”Ÿç‰©äº¤äº’æ—¶è§¦å‘ä¸Šä¸‹æ–‡ç›¸å…³çš„å¯¹è¯æ ‘ï¼ˆå¦‚å–‚é£Ÿå® ç‰©åè§¦å‘æ„Ÿè°¢è¯­éŸ³ï¼‰ã€‚  
- **æ¶æ„åˆ†å±‚**ï¼š  
  ```plaintext
  ç©å®¶è¾“å…¥/äº‹ä»¶ â†’ Lua é€»è¾‘å±‚ï¼ˆè¯·æ±‚ç»„è£…ï¼‰ â†’ C ç½‘ç»œå±‚ï¼ˆHTTP è°ƒç”¨ DeepSeek APIï¼‰ â†’ å“åº”è§£æ â†’ å¯¹è¯å±•ç¤º
  ```

---

#### **2. æŠ€æœ¯å®ç°ç»†èŠ‚**  
##### **2.1 HTTP è¯·æ±‚å°è£…ï¼ˆC å±‚ï¼‰**  
- **ç›®çš„**ï¼šLua ç›´æ¥è°ƒç”¨ HTTP è¯·æ±‚å­˜åœ¨å±€é™æ€§ï¼ˆå¦‚å¼‚æ­¥æ”¯æŒå¼±ï¼‰ï¼Œéœ€é€šè¿‡ C æ‰©å±•å®ç°é«˜æ€§èƒ½ç½‘ç»œé€šä¿¡ã€‚  
- **å®ç°æ­¥éª¤**ï¼š  
  1. **C æ¨¡å—ç¼–å†™**ï¼šåŸºäº `libcurl` å°è£…å¼‚æ­¥ HTTP å®¢æˆ·ç«¯ï¼Œæ”¯æŒéé˜»å¡è¯·æ±‚ã€‚  
  2. **Lua ç»‘å®š**ï¼šæš´éœ² `deepseek_request(prompt, callback)` å‡½æ•°ç»™ Lua å±‚ã€‚  
  ```c
  // ç¤ºä¾‹ï¼šC å±‚å¼‚æ­¥è¯·æ±‚å°è£…
  static int lua_deepseek_request(lua_State *L) {
      const char *prompt = luaL_checkstring(L, 1);
      int callback_ref = luaL_ref(L, LUA_REGISTRYINDEX);  // ä¿å­˜ Lua å›è°ƒå‡½æ•°

      // å¯åŠ¨å¼‚æ­¥çº¿ç¨‹æ‰§è¡Œ curl è¯·æ±‚
      start_async_curl_request(prompt, [L, callback_ref](const char *response) {
          lua_rawgeti(L, LUA_REGISTRYINDEX, callback_ref);
          lua_pushstring(L, response);
          lua_call(L, 1, 0);  // è°ƒç”¨ Lua å›è°ƒ
          luaL_unref(L, LUA_REGISTRYINDEX, callback_ref);
      });
      return 0;
  }
  ```

##### **2.2 Lua é€»è¾‘å±‚ï¼ˆè¯·æ±‚ç»„è£…ä¸å“åº”å¤„ç†ï¼‰**  
- **åŠ¨æ€å¯¹è¯è§¦å‘**ï¼š  
  - ç›‘å¬ç©å®¶äº‹ä»¶ï¼ˆå¦‚æ”»å‡»ç”Ÿç‰©ã€é‡‡é›†èµ„æºï¼‰æˆ–ç¯å¢ƒå˜åŒ–ï¼ˆå­£èŠ‚ã€æ˜¼å¤œï¼‰ã€‚  
  - æ ¹æ®ä¸Šä¸‹æ–‡ç”Ÿæˆå¯¹è¯æç¤ºè¯ï¼ˆPromptï¼‰ï¼Œè°ƒç”¨ C å°è£…çš„ APIã€‚  
  ```lua
  -- ç¤ºä¾‹ï¼šç©å®¶é è¿‘ NPC æ—¶è§¦å‘å¯¹è¯
  local function OnPlayerApproach(inst, player)
      local context = {
          time = GetWorldTime(),
          season = GetSeason(),
          player_health = player.components.health:GetPercent()
      }
      local prompt = string.format(
          "ä½œä¸ºå®ˆå«ï¼Œå½“å‰æ˜¯%så­£ï¼Œæ—¶é—´%sï¼Œç©å®¶ç”Ÿå‘½å€¼%d%%ï¼Œç”Ÿæˆä¸€å¥æé†’ï¼š",
          context.season, context.time, context.player_health * 100
      )
      -- è°ƒç”¨ C å±‚å°è£…çš„ API
      deepseek_request(prompt, function(response)
          inst.components.talker:Say(response)  -- NPC è¯´å‡ºè¿”å›å†…å®¹
      end)
  end
  ```

##### **2.3 å®‰å…¨ä¸æ€§èƒ½ä¼˜åŒ–**  
- **API å¯†é’¥ç®¡ç†**ï¼š  
  - å¯†é’¥ä¸å­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼Œé€šè¿‡æ¨¡ç»„æœåŠ¡å™¨ä»£ç†è½¬å‘è¯·æ±‚ï¼ˆé¿å…æ³„éœ²ï¼‰ã€‚  
  - è¯·æ±‚ç­¾åï¼šC å±‚æ·»åŠ  HMAC ç­¾åï¼ŒæœåŠ¡å™¨éªŒè¯è¯·æ±‚åˆæ³•æ€§ã€‚  
- **è¯·æ±‚ç¼“å­˜ä¸é™æµ**ï¼š  
  - å¯¹ç›¸åŒä¸Šä¸‹æ–‡ï¼ˆå¦‚ `prompt` å“ˆå¸Œå€¼ï¼‰ç¼“å­˜å“åº”ç»“æœï¼Œå‡å°‘ API è°ƒç”¨æ¬¡æ•°ã€‚  
  - ä½¿ç”¨æ¼æ¡¶ç®—æ³•é™åˆ¶ç©å®¶æ¯åˆ†é’Ÿæœ€å¤§è¯·æ±‚æ¬¡æ•°ï¼ˆå¦‚ 5 æ¬¡/åˆ†é’Ÿï¼‰ã€‚  
  ```lua
  -- ç¤ºä¾‹ï¼šç¼“å­˜ä¸é™æµé€»è¾‘
  local CACHE = {}
  local RATE_LIMIT = {}
  function SafeDeepSeekRequest(prompt, callback)
      local key = hash(prompt)
      -- æ£€æŸ¥ç¼“å­˜
      if CACHE[key] then
          callback(CACHE[key])
          return
      end
      -- æ£€æŸ¥é™æµ
      local player_id = GetPlayerID()
      if (RATE_LIMIT[player_id] or 0) >= 5 then
          callback("å¯¹è¯è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•ï¼")
          return
      end
      -- å‘èµ·è¯·æ±‚
      deepseek_request(prompt, function(response)
          CACHE[key] = response
          RATE_LIMIT[player_id] = (RATE_LIMIT[player_id] or 0) + 1
          callback(response)
      end)
  end
  ```

---

#### **3. å¯¹è¯ç³»ç»Ÿé›†æˆ**  
##### **3.1 å¯¹è¯å†…å®¹åŠ¨æ€åŒ–**  
- **æƒ…æ„Ÿå‚æ•°æ³¨å…¥**ï¼š  
  - ä¸º NPC è®¾è®¡æƒ…æ„ŸçŠ¶æ€ï¼ˆå¦‚æ„¤æ€’ã€å‹å¥½ï¼‰ï¼Œå½±å“ DeepSeek ç”Ÿæˆå¯¹è¯çš„è¯­æ°”ã€‚  
  ```lua
  local emotion = inst.components.emotion:GetState()
  local prompt = string.format("ä½ æ˜¯ä¸€ä¸ª%sçš„å•†äººï¼Œå›å¤ç©å®¶è¯·æ±‚ï¼š%s", emotion, player_question)
  ```

##### **3.2 å¤šè¯­è¨€æ”¯æŒ**  
- **å“åº”ç¿»è¯‘**ï¼šè°ƒç”¨ DeepSeek çš„ç¿»è¯‘ APIï¼Œæ”¯æŒå¤šè¯­è¨€ç©å®¶ç¾¤ä½“ã€‚  
  ```lua
  -- ç¤ºä¾‹ï¼šè‡ªåŠ¨ç¿»è¯‘ä¸ºç©å®¶è®¾ç½®çš„è¯­è¨€
  deepseek_request("å°†ä»¥ä¸‹å†…å®¹ç¿»è¯‘ä¸ºè‹±æ–‡ï¼š" .. response, function(translated)
      ShowTranslatedText(translated)
  end)
  ```

##### **3.3 è°ƒè¯•ä¸ç›‘æ§**  
- **æ—¥å¿—è®°å½•**ï¼šè®°å½•æ‰€æœ‰è¯·æ±‚ä¸å“åº”ï¼Œç”¨äºåˆ†æå¯¹è¯è´¨é‡ã€‚  
  ```lua
  Log("DeepSeek Request:", prompt)
  Log("DeepSeek Response:", response)
  ```
- **æ•æ„Ÿè¯è¿‡æ»¤**ï¼šåœ¨è¿”å›å¯¹è¯å‰è¿›è¡Œå†…å®¹è¿‡æ»¤ã€‚  
  ```lua
  local filtered = FilterSensitiveWords(response)
  inst.components.talker:Say(filtered)
  ```

---

#### **4. æ€§èƒ½ä¸å…¼å®¹æ€§ä¿éšœ**  
- **é™çº§ç­–ç•¥**ï¼š  
  - å½“ API ä¸å¯ç”¨æ—¶ï¼Œåˆ‡æ¢è‡³é¢„ç½®å¯¹è¯åº“ã€‚  
  - ç¤ºä¾‹ï¼š  
    ```lua
    local response = api_response or DEFAULT_RESPONSES[math.random(1, #DEFAULT_RESPONSES)]
    ```
- **åç¨‹å¼‚æ­¥åŒ–**ï¼š  
  - ä½¿ç”¨ Lua åç¨‹é¿å…å›è°ƒåœ°ç‹±ï¼Œæå‡ä»£ç å¯è¯»æ€§ã€‚  
  ```lua
  local co = coroutine.create(function()
      local response = deepseek_request_async(prompt)  -- åç¨‹ç‰ˆå°è£…
      inst.components.talker:Say(response)
  end)
  coroutine.resume(co)
  ```

---

#### **5. å®é™…åº”ç”¨åœºæ™¯ç¤ºä¾‹**  
**åœºæ™¯**ï¼šç©å®¶åœ¨é›¨å¤©è¯•å›¾ç‚¹ç‡ƒç¯ç«å¤±è´¥ã€‚  
1. **äº‹ä»¶è§¦å‘**ï¼š`OnPlayerIgniteFail` äº‹ä»¶æ•è·ã€‚  
2. **ç”Ÿæˆ Prompt**ï¼š  
   ```lua
   "ç©å®¶åœ¨æš´é›¨ä¸­å°è¯•ç‚¹ç‡ƒç¯ç«ä½†å¤±è´¥äº†ï¼Œç”¨å¹½é»˜çš„è¯­æ°”æé†’ä»–éœ€è¦é®é›¨ã€‚"
   ```
3. **API å“åº”**ï¼š  
   ```text
   "å“ˆå“ˆï¼Œé›¨æ°´å’Œç«æŠŠå¯ä¸æ˜¯å¥½æœ‹å‹ï¼å¿«æ‰¾ä¸ªæ ‘æ´èº²é›¨å§ï¼"
   ```
4. **NPC è¡Œä¸º**ï¼šé™„è¿‘çš„æµ£ç†Š NPC æŒ‡å‘æœ€è¿‘çš„é¿é›¨ç‚¹å¹¶è¯´å‡ºè¯¥å¯¹è¯ã€‚

---

### **æŠ€æœ¯ä»·å€¼ä¸æŒ‘æˆ˜**  
| **ä¼˜åŠ¿**                | **æŒ‘æˆ˜**                | **è§£å†³æ–¹æ¡ˆ**                     |
|-------------------------|-------------------------|----------------------------------|
| åŠ¨æ€åŒ–æå‡æ²‰æµ¸æ„Ÿ         | API å»¶è¿Ÿå½±å“å®æ—¶æ€§      | å¼‚æ­¥è°ƒç”¨ + åŠ è½½åŠ¨ç”»æ©é¥°å»¶è¿Ÿ       |
| æ— é™å¯¹è¯å¯èƒ½æ€§           | ç”Ÿæˆå†…å®¹ä¸å¯æ§          | æ•æ„Ÿè¯è¿‡æ»¤ + é¢„å®¡æ ¸æœºåˆ¶          |
| é™ä½æ‰‹åŠ¨ç¼–å†™å¯¹è¯æˆæœ¬     | API è°ƒç”¨æˆæœ¬é«˜          | ç¼“å­˜ + é™æµ + é™çº§ç­–ç•¥           |

---

### **æ€»ç»“**  
é€šè¿‡ **DeepSeek API + Lua/C æ··åˆç¼–ç¨‹**ï¼Œå®ç°äº†ä¸€ä¸ªä½å»¶è¿Ÿã€é«˜å¯æ‰©å±•çš„æ™ºèƒ½å¯¹è¯ç³»ç»Ÿã€‚  
- **å®‰å…¨å±‚**ï¼šä»£ç†æœåŠ¡å™¨ã€è¯·æ±‚ç­¾åã€æ•æ„Ÿè¯è¿‡æ»¤ä¿éšœåˆè§„æ€§ã€‚  
- **æ€§èƒ½å±‚**ï¼šå¼‚æ­¥åŒ–ã€ç¼“å­˜ã€é™æµç¡®ä¿æµç•…ä½“éªŒã€‚  
- **ç”Ÿæ€å±‚**ï¼šç»“åˆç©å®¶åé¦ˆæŒç»­ä¼˜åŒ– Prompt æ¨¡æ¿ï¼Œæå‡å¯¹è¯è‡ªç„¶åº¦ã€‚  
æ­¤æœºåˆ¶å¯è¿›ä¸€æ­¥æ‰©å±•è‡³ä»»åŠ¡ç³»ç»Ÿã€å‰§æƒ…ç”Ÿæˆç­‰åœºæ™¯ï¼Œä¸ºæ¨¡ç»„èµ‹äºˆâ€œAI åŸç”Ÿâ€èƒ½åŠ›ã€‚
```





##### 9. é¥¥è’è”æœºç‰ˆ/æ¸¸æˆ æ¶‰åŠå“ªäº›æŠ€æœ¯ï¼Ÿ

ecs æ¡†æ¶

ai è¡Œä¸ºæ ‘ã€ä½¿ç”¨çŠ¶æ€æœºï¼ˆState Machineï¼‰è®¾è®¡ç”Ÿç‰©è¡Œä¸ºï¼Œé™ä½é€»è¾‘å¤æ‚åº¦ã€‚ã€‘

å®ç°äº†æ¥å…¥ deepseek å®ç°ç”Ÿç‰©å¯¹è¯ç³»ç»Ÿã€‚



##### 10. Python å¸¸ç”¨æ ‡å‡†åº“åŠç¬¬ä¸‰æ–¹åº“

numpy: å¤šç»´æ•°ç»„è®¡ç®—

pandas: æ•°æ®æ¸…æ´—ä¸åˆ†æ

matplotlib: æ•°æ®å¯è§†åŒ–

requests: HTTP è¯·æ±‚å‘é€

Flask: è½»é‡çº§ Web æ¡†æ¶

FastAPI: é«˜æ€§èƒ½ API æ¡†æ¶ï¼ˆæ”¯æŒå¼‚æ­¥ï¼‰

selenium: æµè§ˆå™¨è‡ªåŠ¨åŒ–ï¼ˆçˆ¬è™«/æµ‹è¯•ï¼‰

pytest: å•å…ƒæµ‹è¯•æ¡†æ¶

tqdm: è¿›åº¦æ¡æ˜¾ç¤º

loguru: ç®€åŒ–æ—¥å¿—è®°å½•



##### 11. ORM æ¨¡å‹æ„å»ºã€QuerySet ä¼˜åŒ–åŠæ•°æ®åº“è¿ç§»ç®¡ç†

###### ORM æ¨¡å‹æ„å»º

å¼€å‘è€…ç»§æ‰¿ Model ç±»å®šä¹‰æ¨¡å‹ï¼Œè¿›è¡Œå­—æ®µæ˜ å°„

ModelBase å…ƒç±»åœ¨æ¨¡å‹ç±»å®šä¹‰æ—¶åŠ¨æ€åˆ›å»ºæ•°æ®åº“è¡¨ç»“æ„

å…³è”å…³ç³»ï¼šOneToOneFieldï¼ˆä¸€å¯¹ä¸€ï¼‰ã€ForeignKeyï¼ˆå¤šå¯¹ä¸€ï¼‰ã€ManyToManyFieldï¼ˆå¤šå¯¹å¤šï¼‰



###### QuerySet ä¼˜åŒ–

æƒ°æ€§åŠ è½½ï¼šæŸ¥è¯¢é›†åœ¨çœŸæ­£ä½¿ç”¨æ—¶ï¼ˆå¦‚éå†æˆ–è°ƒç”¨ list()ï¼‰æ‰ç”Ÿæˆ SQL å¹¶æ‰§è¡Œ

SQL ç”Ÿæˆæœºåˆ¶ï¼š

- é“¾å¼è°ƒç”¨
- ç”Ÿæˆ ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ï¼šå°†é“¾å¼è°ƒç”¨è½¬æ¢ä¸ºé€»è¾‘è¡¨è¾¾å¼æ ‘
- ç¼–è¯‘ä¸º SQLï¼šé€šè¿‡ SQLCompiler å°†è¡¨è¾¾å¼æ ‘è½¬æ¢ä¸ºæ•°æ®åº“æ–¹è¨€çš„ SQ



äº‹åŠ¡ç®¡ç†ï¼š

- è£…é¥°å™¨æ¨¡å¼ï¼š@transaction.atomic ä¿®é¥°æŸä¸ªæ–¹æ³•ï¼Œç”Ÿæˆ BEGIN; COMMIT; åŒ…è£¹çš„ SQL è¯­å¥



èšåˆä¸æ³¨è§£ï¼š

annotate æ„å»ºå¤æ‚æŸ¥è¯¢





###### æ•°æ®åº“è¿ç§»ç®¡ç†

ä½¿ç”¨ makemigrations å’Œ migrate å¤„ç†æ•°æ®åº“å˜æ›´ï¼Œæ‰‹åŠ¨ç¼–å†™è¿ç§»æ–‡ä»¶åº”å¯¹å¤æ‚åœºæ™¯





##### 12. MySQL ç´¢å¼•ä¼˜åŒ–ã€äº‹åŠ¡éš”ç¦»çº§åˆ«åŠæ…¢æŸ¥è¯¢åˆ†æ

###### MySQL ç´¢å¼•ä¼˜åŒ–

**æ ¸å¿ƒåŸåˆ™**ï¼š

- **ç´¢å¼•ç±»å‹**ï¼šB+Treeï¼ˆé»˜è®¤ï¼‰ã€Hashï¼ˆå†…å­˜è¡¨ï¼‰ã€å…¨æ–‡ç´¢å¼•ï¼ˆFULLTEXTï¼‰
- **è”åˆç´¢å¼•**ï¼šéµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™ï¼ˆå¦‚ `INDEX (a, b, c)` å¯ä¼˜åŒ– `WHERE a=1 AND b=2`ï¼‰
- **è¦†ç›–ç´¢å¼•**ï¼šé€šè¿‡ `EXPLAIN` æ£€æŸ¥ `Extra: Using index`



**ä¼˜åŒ–å·¥å…·**ï¼š

- **`EXPLAIN`**ï¼šåˆ†ææŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ï¼Œå…³æ³¨ `type`ï¼ˆè®¿é—®ç±»å‹ï¼‰å’Œ `rows`ï¼ˆæ‰«æè¡Œæ•°ï¼‰
- **`pt-query-digest`**ï¼šåˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œå®šä½é«˜é¢‘ä½æ•ˆ SQL



**å®æˆ˜å»ºè®®**ï¼š

- å¯¹ç°æœ‰é¡¹ç›®çš„æ…¢æŸ¥è¯¢æ—¥å¿—è¿›è¡Œåˆ†æï¼Œæ‰¾å‡ºæœªå‘½ä¸­ç´¢å¼•çš„ SQL å¹¶ä¼˜åŒ–
- æ¨¡æ‹Ÿé«˜å¹¶å‘åœºæ™¯ï¼Œä½¿ç”¨ `sysbench` æµ‹è¯•ç´¢å¼•ä¼˜åŒ–æ•ˆæœ



###### äº‹åŠ¡éš”ç¦»çº§åˆ«

**å…³é”®æ¦‚å¿µ**ï¼š

- **ACID ç‰¹æ€§**ï¼šåŸå­æ€§ï¼ˆAtomicityï¼‰ã€ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€éš”ç¦»æ€§ï¼ˆIsolationï¼‰ã€æŒä¹…æ€§ï¼ˆDurabilityï¼‰
- éš”ç¦»çº§åˆ«ï¼š
  - `READ UNCOMMITTED`ï¼šå¯èƒ½è¯»åˆ°è„æ•°æ®
  - `READ COMMITTED`ï¼ˆé»˜è®¤ï¼‰ï¼šé¿å…è„è¯»ï¼Œä½†å­˜åœ¨ä¸å¯é‡å¤è¯»
  - `REPEATABLE READ`ï¼šä¿è¯åŒä¸€äº‹åŠ¡å†…å¤šæ¬¡è¯»å–ç»“æœä¸€è‡´
  - `SERIALIZABLE`ï¼šå®Œå…¨ä¸²è¡ŒåŒ–ï¼Œæ€§èƒ½æœ€ä½

- **å®æˆ˜åœºæ™¯**ï¼š
  - **è½¬è´¦æ“ä½œ**ï¼šä½¿ç”¨äº‹åŠ¡ä¿è¯æ‰£æ¬¾ä¸åˆ°è´¦çš„åŸå­æ€§
  - **åº“å­˜æ‰£å‡**ï¼šç»“åˆ `SELECT ... FOR UPDATE` ==å®ç°æ‚²è§‚é”==



###### æ…¢æŸ¥è¯¢åˆ†æ

æ“ä½œæµç¨‹ï¼š

- å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—

  ```ini
  # my.cnf
  slow_query_log = ON
  long_query_time = 1  # è®°å½•è¶…è¿‡1ç§’çš„æŸ¥è¯¢
  slow_query_log_file = /var/log/mysql/slow.log
  ```

- ä½¿ç”¨ pt-query-digest åˆ†ææ—¥å¿—

  ```bash
  pt-query-digest /var/log/mysql/slow.log > slow_report.txt
  ```

- ==æ ¹æ®æŠ¥å‘Šä¼˜åŒ– SQL æˆ–ç´¢å¼•==



````markdown
### ğŸ¤– Assistant

---

ä½¿ç”¨ `pt-query-digest` åˆ†æ MySQL æ…¢æŸ¥è¯¢æ—¥å¿—åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ç³»ç»Ÿæ€§æ–¹æ³•ä¼˜åŒ– SQL å’Œç´¢å¼•ï¼š

---

### **ä¸€ã€åˆ†ææŠ¥å‘Šå…³é”®æŒ‡æ ‡**
åœ¨ `pt-query-digest` è¾“å‡ºä¸­é‡ç‚¹å…³æ³¨ï¼š
```bash
# Profile
# Rank Query ID           Response time  Calls R/Call   Apdx V/M   Item
# ==== ================== ============== ===== ======== ==== ===== ========
#    1 0xABCDEF123456789  112.2345 68.3%  1000  0.1122   1.0  0.00 SELECT orders
#    2 0xBCDEF123456789A   34.5678 21.1%   500  0.0691   1.0  0.00 UPDATE inventory
```
é‡ç‚¹å…³æ³¨ï¼š
- **Response timeå æ¯”**ï¼ˆå¦‚ 68.3%ï¼‰
- **æ‰§è¡Œæ¬¡æ•°**ï¼ˆCallsï¼‰
- **å•æ¬¡æ‰§è¡Œè€—æ—¶**ï¼ˆR/Callï¼‰
- **æ‰«æè¡Œæ•°**ï¼ˆRows Examineï¼‰
- **é”å®šæ—¶é—´**ï¼ˆLock Timeï¼‰

---

### **äºŒã€é’ˆå¯¹æ€§ä¼˜åŒ–ç­–ç•¥**

#### **1. é«˜å“åº”æ—¶é—´å æ¯”çš„æŸ¥è¯¢**
**æ¡ˆä¾‹**ï¼šæŸä¸ª SELECT å  68% æ€»æ—¶é—´
```sql
SELECT * FROM orders 
WHERE user_id=123 
AND create_time BETWEEN '2023-01-01' AND '2023-12-31'
ORDER BY amount DESC
LIMIT 100;
```

**ä¼˜åŒ–æ­¥éª¤**ï¼š
1. **æ£€æŸ¥æ‰§è¡Œè®¡åˆ’**ï¼š
   ```sql
   EXPLAIN SELECT ...; -- æŸ¥çœ‹æ˜¯å¦ä½¿ç”¨ç´¢å¼•
   ```

2. **æ·»åŠ å¤åˆç´¢å¼•**ï¼š
   ```sql
   ALTER TABLE orders ADD INDEX idx_user_time (user_id, create_time);
   ```

3. **é¿å…å…¨è¡¨æ‰«æ**ï¼š
   - å¦‚æœ `amount` æ’åºå¯¼è‡´ filesortï¼Œæ·»åŠ è¦†ç›–ç´¢å¼•ï¼š
     ```sql
     ALTER TABLE orders ADD INDEX idx_user_time_amount (user_id, create_time, amount);
     ```

---

#### **2. é«˜æ‰«æè¡Œæ•°çš„æŸ¥è¯¢**
**æŠ¥å‘Šç‰¹å¾**ï¼š
```bash
# Query 1: Rows Examine = 1,234,567
```

**ä¼˜åŒ–æ–¹æ³•**ï¼š
1. **å‡å°‘æ‰«æèŒƒå›´**ï¼š
   ```sql
   -- åŸå§‹æŸ¥è¯¢
   SELECT * FROM logs 
   WHERE status IN (1,2,3) 
     AND created_at > '2023-01-01';

   -- æ·»åŠ åˆ†åŒºç´¢å¼•
   ALTER TABLE logs ADD INDEX idx_status_created (status, created_at);
   ```

2. **ä½¿ç”¨è¦†ç›–ç´¢å¼•**ï¼š
   ```sql
   -- éœ€è¦è¿”å›çš„åˆ—éƒ½åŒ…å«åœ¨ç´¢å¼•ä¸­
   ALTER TABLE products ADD INDEX idx_category_price (category_id, price);
   ```

---

#### **3. é«˜é”å®šæ—¶é—´çš„æŸ¥è¯¢**
**æŠ¥å‘Šç‰¹å¾**ï¼š
```bash
# Query 2: Lock Time = 5.2s
```

**ä¼˜åŒ–æ–¹æ³•**ï¼š
1. **äº‹åŠ¡æ‹†åˆ†**ï¼š
   ```sql
   -- åŸäº‹åŠ¡ï¼ˆé”å®šæ—¶é—´è¿‡é•¿ï¼‰
   BEGIN;
   UPDATE accounts SET balance = balance - 100 WHERE user_id = 456;
   INSERT INTO transactions (...) VALUES (...);
   COMMIT;

   -- æ”¹ä¸ºå¼‚æ­¥å¤„ç†
   -- å…ˆå¿«é€Ÿæ‰§è¡ŒUPDATEï¼Œäº‹åŠ¡æäº¤åå†è®°å½•æ—¥å¿—
   ```

2. **é™ä½éš”ç¦»çº§åˆ«**ï¼š
   ```sql
   SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;
   ```

---

#### **4. é«˜é¢‘æ‰§è¡Œçš„ç®€å•æŸ¥è¯¢**
**æŠ¥å‘Šç‰¹å¾**ï¼š
```bash
# Query 3: Calls = 10,000, R/Call = 0.002s
```

**ä¼˜åŒ–æ–¹æ³•**ï¼š
1. **æŸ¥è¯¢ç¼“å­˜**ï¼š
   ```sql
   -- å¯ç”¨ç¼“å­˜ï¼ˆMySQL 8.0+ï¼‰
   SELECT SQL_CACHE * FROM config WHERE key = 'site_name';
   ```

2. **æ‰¹é‡æ“ä½œæ›¿ä»£å¾ªç¯**ï¼š
   ```sql
   -- åŸå§‹ï¼šå¾ªç¯æ‰§è¡Œ100æ¬¡
   INSERT INTO log (message) VALUES ('msg1');
   INSERT INTO log (message) VALUES ('msg2');
   ...

   -- ä¼˜åŒ–ä¸ºæ‰¹é‡æ’å…¥
   INSERT INTO log (message) VALUES ('msg1'), ('msg2'), ...;
   ```

---

### **ä¸‰ã€ç´¢å¼•ä¼˜åŒ–é»„é‡‘æ³•åˆ™**
| **é—®é¢˜ç±»å‹**          | **ä¼˜åŒ–æ–¹æ¡ˆ**                              | **ç¤ºä¾‹**                                  |
|-----------------------|------------------------------------------|------------------------------------------|
| å…¨è¡¨æ‰«æ              | æ·»åŠ  WHERE æ¡ä»¶åˆ—çš„ç´¢å¼•                   | `ADD INDEX (status)`                     |
| æ’åºæ–‡ä»¶æ’åºï¼ˆfilesortï¼‰ | åˆ›å»ºåŒ…å«æ’åºå­—æ®µçš„å¤åˆç´¢å¼•                | `ADD INDEX (category, price)`            |
| å›è¡¨æŸ¥è¯¢              | ä½¿ç”¨è¦†ç›–ç´¢å¼•                              | `ADD INDEX (user_id, create_time, amount)`|
| ç´¢å¼•åˆå¹¶              | ç”¨å¤åˆç´¢å¼•æ›¿ä»£å¤šä¸ªå•åˆ—ç´¢å¼•                | å°† `(a)` å’Œ `(b)` åˆå¹¶ä¸º `(a,b)`         |

---

### **å››ã€SQL æ”¹å†™æŠ€å·§**
#### **1. é¿å…éšå¼ç±»å‹è½¬æ¢**
```sql
-- åŸå§‹ï¼ˆphoneæ˜¯varcharç±»å‹ï¼‰
SELECT * FROM users WHERE phone = 13800138000; 

-- ä¼˜åŒ–ï¼ˆæ·»åŠ å¼•å·é¿å…å…¨è¡¨æ‰«æï¼‰
SELECT * FROM users WHERE phone = '13800138000';
```

#### **2. åˆ†é¡µä¼˜åŒ–**
```sql
-- åŸå§‹ï¼ˆåç§»é‡å¤§æ—¶æ€§èƒ½å·®ï¼‰
SELECT * FROM orders ORDER BY id LIMIT 100000, 20;

-- ä¼˜åŒ–ï¼ˆä½¿ç”¨idå®šä½ï¼‰
SELECT * FROM orders 
WHERE id > (SELECT id FROM orders ORDER BY id LIMIT 100000, 1)
ORDER BY id LIMIT 20;
```

#### **3. JOIN ä¼˜åŒ–**
```sql
-- åŸå§‹ï¼ˆæœªä½¿ç”¨ç´¢å¼•ï¼‰
SELECT * FROM users 
JOIN orders ON users.id = orders.user_id 
WHERE users.country = 'CN';

-- ä¼˜åŒ–ï¼ˆç¡®ä¿é©±åŠ¨è¡¨æœ‰ç´¢å¼•ï¼‰
ALTER TABLE users ADD INDEX idx_country (country);
ALTER TABLE orders ADD INDEX idx_user (user_id);
```

---

### **äº”ã€éªŒè¯ä¼˜åŒ–æ•ˆæœ**
1. **å¯¹æ¯”æ‰§è¡Œè®¡åˆ’**ï¼š
   ```sql
   EXPLAIN SELECT ...; -- æ£€æŸ¥ Extra å­—æ®µæ˜¯å¦å‡ºç° "Using index"
   ```

2. **ç›‘æ§æ”¹è¿›**ï¼š
   ```bash
   # ä¼˜åŒ–åå†æ¬¡è¿è¡Œ pt-query-digest
   pt-query-digest slow.log > slow_report_after.log
   ```

3. **æ€§èƒ½æµ‹è¯•**ï¼š
   ```sql
   -- æ‰§è¡Œæ—¶é—´å¯¹æ¯”
   SELECT BENCHMARK(100000, (SELECT ...)); 
   ```

---

### **å…­ã€é«˜çº§å·¥å…·é…åˆ**
1. **Percona Toolkit è¾…åŠ©**ï¼š
   ```bash
   # æ£€æŸ¥å†—ä½™ç´¢å¼•
   pt-duplicate-key-checker --user=root --password=xxx

   # ç´¢å¼•å»ºè®®
   pt-index-usage slow.log
   ```

2. **MySQL å†…ç½®åˆ†æ**ï¼š
   ```sql
   -- æŸ¥çœ‹ç´¢å¼•ç»Ÿè®¡
   SHOW INDEX FROM orders;

   -- å¼ºåˆ¶ä½¿ç”¨æŸä¸ªç´¢å¼•æµ‹è¯•
   SELECT * FROM orders FORCE INDEX (idx_user) WHERE ...;
   ```

---

### **æ€»ç»“**
é€šè¿‡ `pt-query-digest` åˆ†æåï¼Œä¼˜åŒ–ä¼˜å…ˆçº§åº”ä¸ºï¼š
1. **æ¶ˆç­å…¨è¡¨æ‰«æ**ï¼ˆæ·»åŠ å¿…è¦ç´¢å¼•ï¼‰
2. **å‡å°‘æ•°æ®æ‰«æé‡**ï¼ˆè¦†ç›–ç´¢å¼•ã€åˆ†åŒºï¼‰
3. **é™ä½é”å†²çª**ï¼ˆäº‹åŠ¡æ‹†åˆ†ã€éš”ç¦»çº§åˆ«è°ƒæ•´ï¼‰
4. **é‡æ„é—®é¢˜ SQL**ï¼ˆåˆ†é¡µæ”¹å†™ã€é¿å…éšå¼è½¬æ¢ï¼‰

å…¸å‹ä¼˜åŒ–æ¡ˆä¾‹å¯å°†æŸ¥è¯¢é€Ÿåº¦æå‡ **10-100 å€**ï¼Œä¾‹å¦‚ä¸€ä¸ªåŸæœ¬ 2 ç§’çš„æŸ¥è¯¢é€šè¿‡è¦†ç›–ç´¢å¼•ä¼˜åŒ–åå¯èƒ½åªéœ€ 20 æ¯«ç§’ã€‚
````







##### 13. MongoDB å­˜å‚¨éç»“æ„åŒ–æ•°æ®ï¼Œç»“åˆ Django-MongoEngine è¿›è¡Œæ•°æ®èšåˆåˆ†æ

**æŠ€æœ¯é€‰å‹**ï¼š

- **é€‚ç”¨åœºæ™¯**ï¼šæ—¥å¿—å­˜å‚¨ã€JSON æ–‡æ¡£ã€åŠ¨æ€å­—æ®µéœ€æ±‚
- **é›†æˆæ–¹æ¡ˆ**ï¼šä½¿ç”¨ `django-mongoengine` æ›¿ä»£ Django ORM



#### **æ•°æ®èšåˆåˆ†æ**

- **èšåˆç®¡é“**ï¼š

  - **å¸¸ç”¨æ“ä½œç¬¦**ï¼š`$match`ï¼ˆè¿‡æ»¤ï¼‰ã€`$group`ï¼ˆåˆ†ç»„ï¼‰ã€`$project`ï¼ˆå­—æ®µæŠ•å½±ï¼‰

    ```python
    # ç»Ÿè®¡æ¯ä¸ªé”™è¯¯çº§åˆ«çš„æ—¥å¿—æ•°é‡
    pipeline = [
        {"$match": {"level": "ERROR"}},
        {"$group": {"_id": "$level", "count": {"$sum": 1}}}
    ]
    results = LogEntry.objects.aggregate(pipeline)
    
    ```

- **æ€§èƒ½ä¼˜åŒ–**ï¼š
  - **ç´¢å¼•ä¼˜åŒ–**ï¼šä¸ºé¢‘ç¹æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•
  - **åˆ†ç‰‡é›†ç¾¤**ï¼šåº”å¯¹æµ·é‡æ•°æ®å­˜å‚¨ä¸é«˜å¹¶å‘æŸ¥è¯¢



##### 14. åŸºæœ¬çš„ Linux å‘½ä»¤è¡Œæ“ä½œ

ç›®å½•å¯¼èˆª

```bash
pwd        # æ˜¾ç¤ºå½“å‰ç›®å½•è·¯å¾„
ls         # åˆ—å‡ºç›®å½•å†…å®¹
ls -l      # è¯¦ç»†åˆ—è¡¨ï¼ˆæƒé™/å¤§å°/æ—¶é—´ï¼‰
ls -a      # æ˜¾ç¤ºéšè—æ–‡ä»¶ï¼ˆä»¥.å¼€å¤´çš„æ–‡ä»¶ï¼‰
cd ~       # è¿”å›ç”¨æˆ·ä¸»ç›®å½•
cd ..      # è¿”å›ä¸Šçº§ç›®å½•
```



æ–‡ä»¶æ“ä½œ

```bash
cp file.txt /backup/      # å¤åˆ¶æ–‡ä»¶
mv old.txt new.txt        # é‡å‘½åæ–‡ä»¶
rm file.txt               # åˆ é™¤æ–‡ä»¶ï¼ˆè°¨æ…ï¼ï¼‰
rm -r directory/         # é€’å½’åˆ é™¤ç›®å½•
touch newfile.txt         # åˆ›å»ºç©ºæ–‡ä»¶
mkdir mydir              # åˆ›å»ºç›®å½•
```



æŸ¥çœ‹æ–‡ä»¶

```bash
cat file.txt        # æ˜¾ç¤ºå®Œæ•´æ–‡ä»¶å†…å®¹
less file.txt       # åˆ†é¡µæµè§ˆï¼ˆæ”¯æŒæœç´¢ï¼‰
head -n 5 file.txt  # æ˜¾ç¤ºå‰5è¡Œ
tail -f log.txt     # å®æ—¶è¿½è¸ªæ—¥å¿—æ›´æ–°
```



æ–‡æœ¬å¤„ç†ä¸‰å‰‘å®¢

```bash
grep "error" log.txt          # æŸ¥æ‰¾åŒ…å«"error"çš„è¡Œ
grep -i "warning" log.txt     # å¿½ç•¥å¤§å°å†™æœç´¢
grep -v "success" log.txt     # æ’é™¤åŒ…å«"success"çš„è¡Œ

sed 's/foo/bar/g' file.txt    # æ›¿æ¢æ–‡æœ¬ï¼ˆfooâ†’barï¼‰
awk '{print $1}' data.txt     # æ‰“å°ç¬¬ä¸€åˆ—æ•°æ®

# ç»„åˆä½¿ç”¨ç¤ºä¾‹ï¼š
cat log.txt | grep "ERROR" | awk '{print $3}' | sort | uniq -c
```



æƒé™ç®¡ç†

```bash
chmod 755 script.sh    # è®¾ç½®æƒé™ï¼šrwxr-xr-x
chown user:group file  # ä¿®æ”¹æ–‡ä»¶æ‰€æœ‰è€…å’Œç»„
sudo command           # ä»¥ç®¡ç†å‘˜æƒé™æ‰§è¡Œå‘½ä»¤
```



è¿›ç¨‹ç®¡ç†

```bash
ps aux                # æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹
top                   # å®æ—¶ç³»ç»Ÿç›‘æ§ï¼ˆæŒ‰qé€€å‡ºï¼‰
kill 1234             # ç»ˆæ­¢PIDä¸º1234çš„è¿›ç¨‹
killall nginx         # ç»ˆæ­¢æ‰€æœ‰nginxè¿›ç¨‹
```



ç½‘ç»œæ“ä½œ

```bash
ping google.com       # æµ‹è¯•ç½‘ç»œè¿é€šæ€§
curl -I example.com   # æŸ¥çœ‹HTTPå“åº”å¤´
wget http://example.com/file.zip  # ä¸‹è½½æ–‡ä»¶
netstat -tulpn        # æŸ¥çœ‹ç½‘ç»œè¿æ¥å’Œç«¯å£å ç”¨
```



å‹ç¼©è§£å‹

```bash
tar -czvf archive.tar.gz dir/   # åˆ›å»ºgzipå‹ç¼©åŒ…
tar -xzvf archive.tar.gz       # è§£å‹gzipåŒ…
zip -r archive.zip dir/        # åˆ›å»ºzipå‹ç¼©åŒ…
unzip archive.zip              # è§£å‹zipæ–‡ä»¶
```



ç£ç›˜ç®¡ç†

```bash
df -h              # æŸ¥çœ‹ç£ç›˜ç©ºé—´ï¼ˆäººç±»å¯è¯»æ ¼å¼ï¼‰
du -sh dir/        # æŸ¥çœ‹ç›®å½•å¤§å°
free -h            # æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ
```



ç³»ç»Ÿä¿¡æ¯

```bash
uname -a           # æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬
lsb_release -a     # æŸ¥çœ‹Linuxå‘è¡Œç‰ˆä¿¡æ¯
date               # æ˜¾ç¤ºå½“å‰æ—¥æœŸæ—¶é—´
uptime             # æ˜¾ç¤ºç³»ç»Ÿè¿è¡Œæ—¶é—´
```





##### 15. Django ORM å®ç°æºç è§£æ

æ·±å…¥ç†è§£ Django ORM çš„æºç å®ç°

self.savepoint = connection.savepoint()

````markdown
### ğŸ¤– Assistant

è¦æ·±å…¥ç†è§£ Django ORM çš„æºç å®ç°ï¼Œéœ€ä»ä»¥ä¸‹æ ¸å¿ƒæ¨¡å—å’Œæœºåˆ¶å…¥æ‰‹ã€‚ä»¥ä¸‹æ˜¯å¯¹ Django ORM æºç çš„é€å±‚è§£å‰–ï¼ˆåŸºäº Django 4.x ç‰ˆæœ¬ï¼‰ï¼š

---

### ä¸€ã€æ¨¡å‹å®šä¹‰ä¸å…ƒç±»æœºåˆ¶
#### 1. æ¨¡å‹åŸºç±»ï¼š`django.db.models.base.Model`
- **æºç è·¯å¾„**: `django/db/models/base.py`
- **æ ¸å¿ƒé€»è¾‘**ï¼š
  - æ‰€æœ‰ç”¨æˆ·å®šä¹‰çš„æ¨¡å‹ç±»ç»§æ‰¿è‡ª `Model`ï¼Œè€Œ `Model` çš„å…ƒç±»æ˜¯ `ModelBase`ã€‚
  - `ModelBase` åœ¨ç±»å®šä¹‰æ—¶åŠ¨æ€å¤„ç†å­—æ®µã€å…ƒæ•°æ®ï¼Œå¹¶æ„å»ºæ•°æ®åº“è¡¨ç»“æ„ã€‚

#### 2. å…ƒç±» `ModelBase` çš„å·¥ä½œæµç¨‹
```python
# django/db/models/base.py
class ModelBase(type):
    def __new__(cls, name, bases, attrs):
        # 1. æ”¶é›†å­—æ®µä¿¡æ¯
        fields = {}
        for obj_name, obj in attrs.items():
            if isinstance(obj, Field):
                fields[obj_name] = obj
                obj.set_attributes_from_name(obj_name)
        
        # 2. å¤„ç† Meta ç±»é…ç½®
        meta = attrs.pop('Meta', None)
        opts = Options(meta, app_label)
        
        # 3. åˆ›å»ºå®é™…çš„ç±»
        new_class = super().__new__(cls, name, bases, new_attrs)
        
        # 4. æ³¨å†Œåˆ°åº”ç”¨æ³¨å†Œè¡¨
        if opts.app_label:
            apps.register_model(opts.app_label, new_class)
        
        return new_class
```
- **å…³é”®æ“ä½œ**ï¼š
  - **å­—æ®µæ”¶é›†**ï¼šéå†ç±»å±æ€§ï¼Œè¯†åˆ« `Field` å®ä¾‹ï¼ˆå¦‚ `CharField`, `ForeignKey`ï¼‰ã€‚
  - **å…ƒæ•°æ®å¤„ç†**ï¼šè§£æ `class Meta` ä¸­çš„ `db_table`ã€`indexes` ç­‰é…ç½®ã€‚
  - **æ¨¡å‹æ³¨å†Œ**ï¼šå°†æ¨¡å‹æ³¨å†Œåˆ°å…¨å±€çš„ `AppRegistry`ï¼Œç”¨äºåç»­è¿ç§»å’ŒæŸ¥è¯¢ã€‚

---

### äºŒã€æŸ¥è¯¢é›† (`QuerySet`) å®ç°
#### 1. æƒ°æ€§æŸ¥è¯¢æœºåˆ¶
- **æºç è·¯å¾„**: `django/db/models/query.py`
- **æ ¸å¿ƒç±»**: `QuerySet`
- **æ ¸å¿ƒæ–¹æ³•**ï¼š
  - `filter()`/`exclude()`: å°†æ¡ä»¶å­˜å‚¨åˆ° `QuerySet` çš„ `where` æ ‘ä¸­ã€‚
  - `_fetch_all()`: é¦–æ¬¡è®¿é—®æ•°æ®æ—¶è§¦å‘ SQL æ‰§è¡Œã€‚
  - `__iter__()`: éå†æ—¶è§¦å‘ `_fetch_all()`ã€‚

```python
# django/db/models/query.py
class QuerySet:
    def __init__(self, model=None, query=None):
        self.model = model
        self._query = query or sql.Query(model)
        self._result_cache = None  # ç»“æœç¼“å­˜

    def __iter__(self):
        self._fetch_all()  # è§¦å‘æŸ¥è¯¢æ‰§è¡Œ
        return iter(self._result_cache)

    def _fetch_all(self):
        if self._result_cache is None:
            # é€šè¿‡ç¼–è¯‘å™¨ç”Ÿæˆ SQL
            compiler = self.query.get_compiler(using=self.db)
            self._result_cache = list(compiler.execute_sql())
```

#### 2. æŸ¥è¯¢æ¡ä»¶å­˜å‚¨ (`Q` å¯¹è±¡)
- **æºç è·¯å¾„**: `django/db/models/query_utils.py`
- **é€»è¾‘æ ‘æ„å»º**ï¼š
  - `Q` å¯¹è±¡é€šè¿‡ `&`ï¼ˆANDï¼‰ã€`|`ï¼ˆORï¼‰æ“ä½œç¬¦æ„å»ºåµŒå¥—é€»è¾‘ã€‚
  - æœ€ç»ˆè½¬æ¢ä¸º `WhereNode`ï¼ˆ`django/db/models/sql/where.py`ï¼‰ã€‚

---

### ä¸‰ã€SQL ç¼–è¯‘ä¸æ‰§è¡Œ
#### 1. SQL ç¼–è¯‘å™¨ (`SQLCompiler`)
- **æºç è·¯å¾„**: `django/db/models/sql/compiler.py`
- **æ ¸å¿ƒæµç¨‹**ï¼š
  1. **æ”¶é›†å­—æ®µ**ï¼šé€šè¿‡ `get_select()` ç¡®å®š SELECT å­å¥ã€‚
  2. **æ„å»º WHERE æ¡ä»¶**ï¼šé€’å½’å¤„ç† `WhereNode`ã€‚
  3. **ç”Ÿæˆ SQL**ï¼šè°ƒç”¨æ•°æ®åº“åç«¯çš„ `quote_name` ç­‰æ–¹æ³•é€‚é…ä¸åŒæ–¹è¨€ã€‚

```python
# django/db/models/sql/compiler.py
class SQLCompiler:
    def execute_sql(self, result_type=MULTI):
        # ç”Ÿæˆå‚æ•°åŒ– SQL
        sql, params = self.as_sql()
        with self.connection.cursor() as cursor:
            cursor.execute(sql, params)
            return cursor.fetchall()
```

#### 2. æ•°æ®åº“é€‚é…å±‚
- **æºç è·¯å¾„**: `django/db/backends/`
  - `base/base.py`: å®šä¹‰é€šç”¨æ¥å£ã€‚
  - `postgresql/operations.py`: PostgreSQL ç‰¹å®šå®ç°ã€‚
  - `mysql/operations.py`: MySQL ç‰¹å®šå®ç°ã€‚
- **å…³é”®æ–¹æ³•**ï¼š
  - `DatabaseWrapper`: ç®¡ç†è¿æ¥æ± ã€‚
  - `Operations.date_trunc_sql()`: å¤„ç†æ•°æ®åº“å‡½æ•°å·®å¼‚ã€‚

---

### å››ã€å­—æ®µä¸æ•°æ®åº“ç±»å‹æ˜ å°„
#### 1. å­—æ®µåŸºç±»: `django.db.models.Field`
- **æºç è·¯å¾„**: `django/db/models/fields/__init__.py`
- **å­—æ®µå®šä¹‰**ï¼š
```python
class CharField(Field):
    def __init__(self, max_length, **kwargs):
        self.max_length = max_length
        super().__init__(**kwargs)

    def db_type(self, connection):
        # æ ¹æ®æ•°æ®åº“ç±»å‹è¿”å›åˆ—å®šä¹‰
        return connection.creation.data_types['CharField'] % {
            'max_length': self.max_length
        }
```

#### 2. è¿ç§»æ“ä½œ (`Migration`)
- **æºç è·¯å¾„**: `django/db/migrations/`
  - `operations/models.py`: å¤„ç† `CreateModel`ã€`AddField` ç­‰æ“ä½œã€‚
  - `executor.py`: æ‰§è¡Œè¿ç§»è®¡åˆ’ï¼Œç”Ÿæˆ DDL è¯­å¥ï¼ˆå¦‚ `CREATE TABLE`ï¼‰ã€‚

---

### äº”ã€äº‹åŠ¡ç®¡ç†
#### 1. äº‹åŠ¡ä¸Šä¸‹æ–‡ (`atomic`)
- **æºç è·¯å¾„**: `django/db/transaction.py`
- **å®ç°æœºåˆ¶**ï¼š
  - é€šè¿‡ä¸Šä¸‹æ–‡ç®¡ç†å™¨è¿›å…¥äº‹åŠ¡å—ã€‚
  - ä½¿ç”¨ `savepoint` å®ç°åµŒå¥—äº‹åŠ¡ã€‚

```python
# django/db/transaction.py
class Atomic(ContextDecorator):
    def __enter__(self):
        connection = get_connection(self.using)
        if not connection.in_atomic_block:
            connection.set_autocommit(False)
        self.savepoint = connection.savepoint()
        return self

    def __exit__(self, exc_type, exc_value, traceback):
        if exc_type is None:
            try:
                connection.commit()
            except Exception:
                connection.rollback()
                raise
        else:
            connection.rollback()
```

---

### å…­ã€æ‰©å±•æœºåˆ¶
#### 1. è‡ªå®šä¹‰æŸ¥è¯¢è¡¨è¾¾å¼
- **æºç è·¯å¾„**: `django/db/models/expressions.py`
- **ç¤ºä¾‹**ï¼šå®ç° `F` è¡¨è¾¾å¼ï¼ˆå­—æ®µå¼•ç”¨ï¼‰ï¼š
```python
class F(Combinable):
    def __init__(self, name):
        self.name = name

    def resolve_expression(self, query, allow_joins=True, reuse=None):
        # è§£æä¸ºæ•°æ®åº“åˆ—å
        return query.resolve_ref(self.name, allow_joins, reuse)
```

---

### ä¸ƒã€å…³é”®è®¾è®¡æ¨¡å¼
1. **å»¶è¿ŸåŠ è½½ (Lazy Loading)**:
   - `QuerySet` ç›´åˆ°æ•°æ®è®¿é—®æ—¶ (`_fetch_all`) æ‰ç”Ÿæˆ SQLã€‚
2. **ç»„åˆæ¨¡å¼ (Composite)**:
   - `WhereNode` å°†å¤šä¸ªæ¡ä»¶ç»„åˆä¸ºæ ‘å½¢ç»“æ„ã€‚
3. **ç­–ç•¥æ¨¡å¼ (Strategy)**:
   - ä¸åŒæ•°æ®åº“åç«¯é€šè¿‡ `DatabaseOperations` å®ç°å·®å¼‚é€»è¾‘ã€‚

---

### å…«ã€è°ƒè¯•æŠ€å·§
#### 1. è¿½è¸ª ORM è°ƒç”¨æ ˆ
```python
# åœ¨ä»£ç ä¸­æ’å…¥æ–­ç‚¹æŸ¥çœ‹è°ƒç”¨æ ˆ
import pdb; pdb.set_trace()
queryset = MyModel.objects.filter(name__startswith="A")
print(queryset.query)  # æŸ¥çœ‹ç”Ÿæˆ SQL
```

#### 2. æ ¸å¿ƒæ¨¡å—ä»£ç ä½ç½®
| åŠŸèƒ½                | æºç è·¯å¾„                          |
|---------------------|----------------------------------|
| æ¨¡å‹å®šä¹‰            | `django/db/models/base.py`       |
| æŸ¥è¯¢é›†              | `django/db/models/query.py`      |
| SQL ç¼–è¯‘å™¨          | `django/db/models/sql/compiler.py` |
| æ•°æ®åº“è¿æ¥          | `django/db/backends/base/base.py` |
| è¿ç§»æ“ä½œ            | `django/db/migrations/operations` |

---

### æ€»ç»“
Django ORM çš„æºç å®ç°é€šè¿‡ä»¥ä¸‹æ ¸å¿ƒæœºåˆ¶å®ç°å¯¹è±¡-å…³ç³»æ˜ å°„ï¼š
1. **å…ƒç±»åŠ¨æ€æ„å»ºæ¨¡å‹**ï¼šé€šè¿‡ `ModelBase` æ”¶é›†å­—æ®µä¿¡æ¯å¹¶æ³¨å†Œæ¨¡å‹ã€‚
2. **æƒ°æ€§æŸ¥è¯¢é›†**ï¼š`QuerySet` å»¶è¿Ÿ SQL ç”Ÿæˆç›´åˆ°æ•°æ®å®é™…è®¿é—®ã€‚
3. **æ¨¡å—åŒ– SQL ç¼–è¯‘**ï¼šé€šè¿‡ `SQLCompiler` å°†æŸ¥è¯¢é€»è¾‘è½¬æ¢ä¸ºæ•°æ®åº“æ–¹è¨€ã€‚
4. **äº‹åŠ¡åŸå­æ€§**ï¼šåˆ©ç”¨æ•°æ®åº“çš„ `SAVEPOINT` å®ç°åµŒå¥—äº‹åŠ¡ã€‚

æ·±å…¥æºç çš„å…³é”®æ˜¯ç†è§£ `Query` åˆ° `SQLCompiler` çš„è½¬æ¢æµç¨‹ï¼Œä»¥åŠå„æ•°æ®åº“åç«¯çš„é€‚é…å±‚å®ç°ã€‚
````





##### 16. å¹³æ—¶æ˜¯å¦æœ‰æ„è¯†åœ°é˜…è¯»æºä»£ç ï¼Ÿ

Lua æºç é˜…è¯»è¿‡





